<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom scrollbar for transaction list */
        #transaction-list::-webkit-scrollbar {
            width: 6px;
        }
        #transaction-list::-webkit-scrollbar-track {
            background: #f1f5f9; /* gray-100 */
        }
        #transaction-list::-webkit-scrollbar-thumb {
            background: #94a3b8; /* gray-400 */
            border-radius: 3px;
        }
        #transaction-list::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* gray-500 */
        }

        /* Styling for progress bar */
        .progress-bar {
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 0.375rem; /* rounded-md */
            overflow: hidden;
            height: 1.25rem; /* h-5 */
        }
        .progress-bar-fill {
            height: 100%;
            transition: width 0.3s ease-in-out;
/* ... existing code ... -->
            font-weight: 500; /* font-medium */
            line-height: 1.25rem; /* leading-5 */
        }

        /* NEW: Styles for Edit Modal */
        #edit-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }
        #edit-modal-content {
            transform: scale(0.95);
            transition: transform 0.2s ease;
        }
        #edit-modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        #edit-modal-overlay.visible #edit-modal-content {
            transform: scale(1);
        }
    </style>
    <script>
        tailwind.config = {
/* ... existing code ... -->
                    </div>
                </div>

            </div>

        </div>
    </div>

    <!-- NEW: Edit Transaction Modal -->
    <div id="edit-modal-overlay" class="visible"> <!-- Start as visible for layout, JS will hide it -->
        <div id="edit-modal-content" class="bg-white w-full max-w-lg p-6 rounded-xl shadow-2xl border border-gray-200 space-y-4">
            <div class="flex justify-between items-center">
                <h2 class="text-lg font-semibold text-gray-700">Edit Transaction</h2>
                <button id="edit-modal-close" class="text-gray-400 hover:text-gray-700 font-bold text-lg">&times;</button>
            </div>
            
            <form id="edit-transaction-form" class="space-y-4">
                <!-- Hidden input to store transaction ID -->
                <input type="hidden" id="edit-transaction-id">

                <!-- Description -->
                <div>
                    <label for="edit-description" class="block text-sm font-medium text-gray-700">Description</label>
                    <input type="text" id="edit-description" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>

                <!-- Amount -->
                <div>
                    <label for="edit-amount" class="block text-sm font-medium text-gray-700">Amount</label>
                    <input type="number" id="edit-amount" step="0.01" min="0.01" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>

                <!-- Date -->
                <div>
                    <label for="edit-date" class="block text-sm font-medium text-gray-700">Date</label>
                    <input type="date" id="edit-date" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>

                <!-- Type (Income/Expense) -->
                <div class="flex gap-4">
                    <div class="flex items-center">
                        <input id="edit-type-income" name="edit-type" type="radio" value="income" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                        <label for="edit-type-income" class="ml-2 block text-sm font-medium text-gray-700">Income</label>
                    </div>
                    <div class="flex items-center">
                        <input id="edit-type-expense" name="edit-type" type="radio" value="expense" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                        <label for="edit-type-expense" class="ml-2 block text-sm font-medium text-gray-700">Expense</label>
                    </div>
                </div>

                <!-- Category (for expenses) -->
                <div id="edit-category-wrapper">
                    <label for="edit-category" class="block text-sm font-medium text-gray-700">Category</label>
                    <select id="edit-category" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option>Food</option>
                        <option>Transport</option>
                        <option>Utilities</option>
                        <option>Rent</option>
                        <option>Entertainment</option>
                        <option>Other</option>
                    </select>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                    Save Changes
                </button>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
/* ... existing code ... -->
            const budgetCategoryInput = document.getElementById('budget-category');
            const budgetAmountInput = document.getElementById('budget-amount');
            const budgetStatusListEl = document.getElementById('budget-status-list');

            // NEW: Edit Modal Elements
            const editModalOverlay = document.getElementById('edit-modal-overlay');
            const editModalCloseBtn = document.getElementById('edit-modal-close');
            const editForm = document.getElementById('edit-transaction-form');
            const editTransactionIdInput = document.getElementById('edit-transaction-id');
            const editDescriptionInput = document.getElementById('edit-description');
            const editAmountInput = document.getElementById('edit-amount');
            const editDateInput = document.getElementById('edit-date');
            const editTypeIncomeRadio = document.getElementById('edit-type-income');
            const editTypeExpenseRadio = document.getElementById('edit-type-expense');
            const editCategoryWrapper = document.getElementById('edit-category-wrapper');
            const editCategoryInput = document.getElementById('edit-category');


            let expenseChart; // To hold the chart instance
/* ... existing code ... -->
                    item.innerHTML = `
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-gray-800 truncate">${t.description}</div>
                            <div class="text-sm text-gray-500">${t.date} ${isExpense ? `(${t.category})` : ''}</div>
                        </div>
                        <div class="flex items-center">
                            <div class="${colorClass} font-semibold mx-4">${sign}${formatCurrency(t.amount, false)}</div>
                            <!-- NEW: Edit Button -->
                            <button onclick="openEditModal(${t.id})" class="text-gray-400 hover:text-blue-600 font-bold text-lg px-2 rounded-full transition-colors" title="Edit">âœŽ</button>
                            <button onclick="deleteTransaction(${t.id})" class="text-gray-400 hover:text-red-600 font-bold text-lg px-2 rounded-full transition-colors" title="Delete">&times;</button>
                        </div>
                    `;
                    transactionListEl.appendChild(item);
/* ... existing code ... -->
                }
            }

            /**
/* ... existing code ... -->
                 * NEW: Handle budget form submission
                 * @param {Event} e
                 */
/* ... existing code ... -->
                budgetAmountInput.value = '';
            }

            /**
/* ... existing code ... -->
                    transactions = transactions.filter(t => t.id !== id);
                    saveTransactions();
                    updateUI();
                }
            }

            // --- NEW: Edit Modal Functions ---

            /**
             * Open and populate the edit modal for a specific transaction
             * @param {number} id
             */
            window.openEditModal = function(id) {
                const transaction = transactions.find(t => t.id === id);
                if (!transaction) return;

                // Populate form fields
                editTransactionIdInput.value = transaction.id;
                editDescriptionInput.value = transaction.description;
                editAmountInput.value = transaction.amount;
                editDateInput.value = transaction.date;

                if (transaction.type === 'income') {
                    editTypeIncomeRadio.checked = true;
                    editCategoryWrapper.style.display = 'none';
                } else {
                    editTypeExpenseRadio.checked = true;
                    editCategoryInput.value = transaction.category;
                    editCategoryWrapper.style.display = 'block';
                }
                
                // Show the modal
                editModalOverlay.classList.add('visible');
            }

            /**
             * Close the edit modal
             */
            function closeEditModal() {
                editModalOverlay.classList.remove('visible');
            }

            /**
             * Handle submission of the edit form
             * @param {Event} e
             */
            function handleEditSubmit(e) {
                e.preventDefault();

                // Get values from edit form
                const id = parseInt(editTransactionIdInput.value);
                const description = editDescriptionInput.value;
                const amount = parseFloat(editAmountInput.value);
                const date = editDateInput.value;
                const type = editTypeIncomeRadio.checked ? 'income' : 'expense';
                const category = (type === 'expense') ? editCategoryInput.value : 'N/A';

                if (!description || !amount || !date) {
                    alert('Please fill in all fields.');
                    return;
                }

                // Find and update the transaction in the state
                const transactionIndex = transactions.findIndex(t => t.id === id);
                if (transactionIndex > -1) {
                    transactions[transactionIndex] = { id, description, amount, date, type, category };
                }

                saveTransactions();
                updateUI();
                closeEditModal();
            }

            /**
             * Toggle visibility of category input based on transaction type (for Edit Form)
             */
            function toggleEditCategory() {
                if (editTypeIncomeRadio.checked) {
                    editCategoryWrapper.style.display = 'none';
                } else {
                    editCategoryWrapper.style.display = 'block';
                }
            }


            /**
             * Helper function to format currency
/* ... existing code ... -->
            form.addEventListener('submit', handleFormSubmit);
            budgetForm.addEventListener('submit', handleBudgetFormSubmit); // NEW: Add listener for budget form
            typeIncomeRadio.addEventListener('change', toggleCategory);
Nothing            typeExpenseRadio.addEventListener('change', toggleCategory);

            // NEW: Edit Modal Listeners
            editForm.addEventListener('submit', handleEditSubmit);
            editModalCloseBtn.addEventListener('click', closeEditModal);
            editModalOverlay.addEventListener('click', (e) => {
                if (e.target === editModalOverlay) { // Only close if clicking the overlay itself
                    closeEditModal();
                }
            });
            editTypeIncomeRadio.addEventListener('change', toggleEditCategory);
            editTypeExpenseRadio.addEventListener('change', toggleEditCategory);
            
            // --- Initialization ---
            dateInput.value = new Date().toISOString().split('T')[0];
            toggleCategory();
            closeEditModal(); // Ensure modal is hidden on load
            loadData();
        });
    </script>
</body>
</html>
